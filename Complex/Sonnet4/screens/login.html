<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>登录 - Accessibility Navigator</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../styles/global.css">
  
  <style>
    .login-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - var(--status-bar-height));
      padding: var(--space-xl);
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: var(--space-xl);
    }
    
    .app-logo {
      width: 80px;
      height: 80px;
      background: var(--accent-blue);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: white;
      margin: 0 auto var(--space-lg);
      box-shadow: 0 10px 30px rgba(0, 122, 255, 0.3);
    }
    
    .login-title {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }
    
    .login-subtitle {
      font-size: var(--font-size-md);
      color: var(--text-secondary);
      line-height: var(--line-height-relaxed);
    }
    
    .login-form {
      width: 100%;
      max-width: 320px;
    }
    
    .form-group {
      margin-bottom: var(--space-lg);
      position: relative;
    }
    
    .form-label {
      display: block;
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }
    
    .form-input {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      transition: all var(--duration-fast) var(--ease-out);
      min-height: 52px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
      background: var(--bg-primary);
    }
    
    .form-input:invalid {
      border-color: var(--accent-red);
    }
    
    .input-icon {
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      font-size: var(--font-size-md);
      pointer-events: none;
    }
    
    .form-input.with-icon {
      padding-left: 48px;
    }
    
    .password-toggle {
      position: absolute;
      right: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: var(--space-sm);
      border-radius: 6px;
      transition: color var(--duration-fast) var(--ease-out);
    }
    
    .password-toggle:hover {
      color: var(--accent-blue);
    }
    
    .form-options {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
    }
    
    .remember-me {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
    
    .checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      background: var(--card-bg);
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      position: relative;
    }
    
    .checkbox:checked {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
    }
    
    .checkbox:checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: bold;
    }
    
    .forgot-password {
      color: var(--accent-blue);
      text-decoration: none;
      font-size: var(--font-size-sm);
      font-weight: 500;
      transition: opacity var(--duration-fast) var(--ease-out);
    }
    
    .forgot-password:hover {
      opacity: 0.8;
    }
    
    .login-button {
      width: 100%;
      padding: var(--space-lg);
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: var(--font-size-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      margin-bottom: var(--space-lg);
      min-height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
    }
    
    .login-button:hover:not(:disabled) {
      background: #0056cc;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }
    
    .login-button:active {
      transform: translateY(0);
    }
    
    .login-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .divider {
      text-align: center;
      margin: var(--space-xl) 0;
      position: relative;
      color: var(--text-tertiary);
      font-size: var(--font-size-sm);
    }
    
    .divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--border-color);
    }
    
    .divider span {
      background: var(--bg-primary);
      padding: 0 var(--space-md);
    }
    
    .social-login {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }
    
    .social-button {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-md);
      min-height: 52px;
    }
    
    .social-button:hover {
      border-color: var(--accent-blue);
      background: var(--bg-primary);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-color);
    }
    
    .social-button i {
      font-size: 20px;
    }
    
    .wechat { color: #07c160; }
    .weibo { color: #e6162d; }
    .apple { color: var(--text-primary); }
    
    .signup-link {
      text-align: center;
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
    
    .signup-link a {
      color: var(--accent-blue);
      text-decoration: none;
      font-weight: 600;
      transition: opacity var(--duration-fast) var(--ease-out);
    }
    
    .signup-link a:hover {
      opacity: 0.8;
    }
    
    .error-message {
      background: rgba(255, 69, 58, 0.1);
      border: 1px solid rgba(255, 69, 58, 0.2);
      color: var(--accent-red);
      padding: var(--space-md);
      border-radius: 8px;
      font-size: var(--font-size-sm);
      margin-bottom: var(--space-lg);
      display: none;
    }
    
    .error-message.show {
      display: block;
      animation: slideInDown 0.3s ease-out;
    }
    
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="device-container">
    <!-- Status Bar -->
    <div class="status-bar">
      <span class="status-time">9:41</span>
      <div class="status-indicators">
        <i class="fas fa-signal" style="font-size: 12px;"></i>
        <i class="fas fa-wifi" style="font-size: 12px;"></i>
        <i class="fas fa-battery-three-quarters" style="font-size: 12px;"></i>
      </div>
    </div>
    
    <!-- Content -->
    <div class="content login-container">
      <div class="login-header">
        <div class="app-logo" role="img" aria-label="无障碍导航应用图标">
          ♿
        </div>
        <h1 class="login-title">欢迎回来</h1>
        <p class="login-subtitle">登录您的账户，继续探索无障碍世界</p>
      </div>
      
      <!-- Error Message -->
      <div class="error-message" id="errorMessage" role="alert" aria-live="polite">
        <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
        <span id="errorText"></span>
      </div>
      
      <!-- Login Form -->
      <form class="login-form" id="loginForm" novalidate>
        <div class="form-group">
          <label for="email" class="form-label">邮箱地址</label>
          <div class="input-container">
            <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
            <input
              type="email"
              id="email"
              class="form-input with-icon"
              placeholder="请输入邮箱地址"
              required
              aria-describedby="email-error"
              autocomplete="email"
            >
          </div>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">密码</label>
          <div class="input-container">
            <i class="fas fa-lock input-icon" aria-hidden="true"></i>
            <input
              type="password"
              id="password"
              class="form-input with-icon"
              placeholder="请输入密码"
              required
              aria-describedby="password-error"
              autocomplete="current-password"
              minlength="6"
            >
            <button 
              type="button" 
              class="password-toggle" 
              onclick="togglePassword()"
              aria-label="显示/隐藏密码"
            >
              <i class="fas fa-eye" id="passwordToggleIcon"></i>
            </button>
          </div>
        </div>
        
        <div class="form-options">
          <label class="remember-me">
            <input type="checkbox" class="checkbox" id="rememberMe">
            记住我
          </label>
          <a href="#" class="forgot-password" onclick="handleForgotPassword()">忘记密码？</a>
        </div>
        
        <button type="submit" class="login-button ripple" id="loginButton">
          <span class="button-text">登录</span>
        </button>
      </form>
      
      <!-- Divider -->
      <div class="divider">
        <span>或者使用以下方式登录</span>
      </div>
      
      <!-- Social Login -->
      <div class="social-login">
        <button class="social-button ripple" onclick="handleSocialLogin('wechat')">
          <i class="fab fa-weixin wechat" aria-hidden="true"></i>
          <span>微信登录</span>
        </button>
        
        <button class="social-button ripple" onclick="handleSocialLogin('weibo')">
          <i class="fab fa-weibo weibo" aria-hidden="true"></i>
          <span>微博登录</span>
        </button>
        
        <button class="social-button ripple" onclick="handleSocialLogin('apple')">
          <i class="fab fa-apple apple" aria-hidden="true"></i>
          <span>Apple 登录</span>
        </button>
      </div>
      
      <!-- Signup Link -->
      <div class="signup-link">
        还没有账户？ <a href="signup.html">立即注册</a>
      </div>
    </div>
  </div>
  
  <script src="../scripts/app.js"></script>
  <script>
    let isSubmitting = false;
    
    // Form validation
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('loginButton');
    const errorMessage = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');
    
    // Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    // Real-time validation
    emailInput.addEventListener('input', validateForm);
    passwordInput.addEventListener('input', validateForm);
    
    function validateForm() {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      
      const isEmailValid = email && emailRegex.test(email);
      const isPasswordValid = password && password.length >= 6;
      
      loginButton.disabled = !(isEmailValid && isPasswordValid) || isSubmitting;
      
      // Visual feedback
      emailInput.style.borderColor = email && !isEmailValid ? 'var(--accent-red)' : '';
      passwordInput.style.borderColor = password && !isPasswordValid ? 'var(--accent-red)' : '';
      
      hideError();
    }
    
    // Form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (isSubmitting) return;
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      
      if (!emailRegex.test(email)) {
        showError('请输入有效的邮箱地址');
        emailInput.focus();
        return;
      }
      
      if (password.length < 6) {
        showError('密码至少需要6个字符');
        passwordInput.focus();
        return;
      }
      
      // Show loading state
      setLoadingState(true);
      
      try {
        // Simulate API call
        await simulateLogin(email, password);
        
        // Success - navigate to home
        localStorage.setItem('user-logged-in', 'true');
        localStorage.setItem('user-email', email);
        
        // In real app: window.location.href = 'home.html';
        showSuccessMessage();
        
      } catch (error) {
        showError(error.message);
      } finally {
        setLoadingState(false);
      }
    });
    
    function setLoadingState(loading) {
      isSubmitting = loading;
      loginButton.disabled = loading;
      
      const buttonText = loginButton.querySelector('.button-text');
      
      if (loading) {
        buttonText.innerHTML = '<div class="loading-spinner"></div>';
      } else {
        buttonText.textContent = '登录';
      }
    }
    
    async function simulateLogin(email, password) {
      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Simulate different scenarios
      if (email === 'error@example.com') {
        throw new Error('服务器错误，请稍后重试');
      }
      
      if (password === 'wrong') {
        throw new Error('邮箱或密码错误');
      }
      
      if (email === 'blocked@example.com') {
        throw new Error('账户已被禁用，请联系客服');
      }
      
      // Success case
      return { success: true };
    }
    
    function showError(message) {
      errorText.textContent = message;
      errorMessage.classList.add('show');
      
      // Auto hide after 5 seconds
      setTimeout(() => {
        hideError();
      }, 5000);
    }
    
    function hideError() {
      errorMessage.classList.remove('show');
    }
    
    function showSuccessMessage() {
      const successMessage = document.createElement('div');
      successMessage.className = 'error-message show';
      successMessage.style.background = 'rgba(48, 209, 88, 0.1)';
      successMessage.style.borderColor = 'rgba(48, 209, 88, 0.2)';
      successMessage.style.color = 'var(--accent-green)';
      successMessage.innerHTML = '<i class="fas fa-check-circle" style="margin-right: 8px;"></i>登录成功！正在跳转...';
      
      errorMessage.parentNode.insertBefore(successMessage, loginForm);
      
      setTimeout(() => {
        successMessage.remove();
      }, 3000);
    }
    
    // Password toggle
    function togglePassword() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      const icon = document.getElementById('passwordToggleIcon');
      icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
    }
    
    // Social login handlers
    async function handleSocialLogin(provider) {
      const button = event.currentTarget;
      const originalText = button.innerHTML;
      
      button.innerHTML = '<div class="loading-spinner"></div>';
      button.disabled = true;
      
      try {
        // Simulate OAuth flow
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Success
        localStorage.setItem('user-logged-in', 'true');
        localStorage.setItem('login-method', provider);
        
        showSuccessMessage();
        
      } catch (error) {
        showError(`${provider} 登录失败，请重试`);
      } finally {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }
    
    function handleForgotPassword() {
      const email = emailInput.value.trim();
      
      if (email && emailRegex.test(email)) {
        showError(`密码重置邮件已发送到 ${email}`);
      } else {
        showError('请先输入有效的邮箱地址');
        emailInput.focus();
      }
    }
    
    // Accessibility enhancements
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && document.activeElement.classList.contains('social-button')) {
        document.activeElement.click();
      }
    });
    
    // Auto-focus on first input
    setTimeout(() => {
      emailInput.focus();
    }, 100);
    
    // Load saved email if remember me was checked
    const savedEmail = localStorage.getItem('remembered-email');
    if (savedEmail) {
      emailInput.value = savedEmail;
      document.getElementById('rememberMe').checked = true;
      passwordInput.focus();
    }
    
    // Save email if remember me is checked
    loginForm.addEventListener('submit', () => {
      const rememberMe = document.getElementById('rememberMe').checked;
      if (rememberMe) {
        localStorage.setItem('remembered-email', emailInput.value);
      } else {
        localStorage.removeItem('remembered-email');
      }
    });
  </script>
</body>
</html>