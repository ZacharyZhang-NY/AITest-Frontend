<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>发布内容 - Accessibility Navigator</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../styles/global.css">
  
  <style>
    .create-container {
      padding-bottom: calc(var(--tab-bar-height) + var(--space-md));
    }
    
    .media-upload {
      position: relative;
      height: 200px;
      background: var(--bg-secondary);
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      margin: var(--space-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }
    
    .media-upload:hover {
      border-color: var(--accent-blue);
      background: rgba(0, 122, 255, 0.05);
    }
    
    .media-upload.has-media {
      padding: 0;
      border-style: solid;
    }
    
    .upload-placeholder {
      text-align: center;
      color: var(--text-secondary);
    }
    
    .upload-icon {
      font-size: 2rem;
      margin-bottom: var(--space-md);
      color: var(--accent-blue);
    }
    
    .upload-text {
      font-size: var(--font-size-md);
      font-weight: 600;
      margin-bottom: var(--space-sm);
    }
    
    .upload-hint {
      font-size: var(--font-size-sm);
      opacity: 0.8;
    }
    
    .media-preview {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .preview-image,
    .preview-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .media-actions {
      position: absolute;
      top: var(--space-sm);
      right: var(--space-sm);
      display: flex;
      gap: var(--space-sm);
    }
    
    .media-action {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }
    
    .form-section {
      margin: var(--space-lg) var(--space-md);
    }
    
    .section-title {
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .form-group {
      margin-bottom: var(--space-lg);
    }
    
    .form-label {
      display: block;
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }
    
    .form-input {
      width: 100%;
      padding: var(--space-md);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      transition: border-color var(--duration-fast) var(--ease-out);
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
      font-family: var(--font-system);
    }
    
    .location-input-wrapper {
      position: relative;
    }
    
    .location-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow-color);
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }
    
    .location-suggestions.show {
      display: block;
    }
    
    .suggestion-item {
      padding: var(--space-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--space-md);
      transition: background var(--duration-fast) var(--ease-out);
    }
    
    .suggestion-item:hover {
      background: var(--bg-secondary);
    }
    
    .suggestion-icon {
      color: var(--accent-blue);
      width: 20px;
    }
    
    .suggestion-text {
      flex: 1;
    }
    
    .suggestion-name {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .suggestion-address {
      font-size: var(--font-size-xs);
      color: var(--text-secondary);
    }
    
    .current-location {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--bg-secondary);
      border-radius: 8px;
      cursor: pointer;
      margin-top: var(--space-sm);
      transition: background var(--duration-fast) var(--ease-out);
    }
    
    .current-location:hover {
      background: var(--bg-tertiary);
    }
    
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-sm);
    }
    
    .template-item {
      padding: var(--space-md);
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      text-align: center;
    }
    
    .template-item:hover {
      border-color: var(--accent-blue);
      background: rgba(0, 122, 255, 0.05);
    }
    
    .template-item.active {
      border-color: var(--accent-blue);
      background: rgba(0, 122, 255, 0.1);
    }
    
    .template-icon {
      font-size: 1.5rem;
      margin-bottom: var(--space-sm);
      color: var(--accent-blue);
    }
    
    .template-name {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .facilities-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
    }
    
    .facility-control {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: var(--space-md);
    }
    
    .facility-header {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }
    
    .facility-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: white;
    }
    
    .facility-icon.slope { background: var(--accent-blue); }
    .facility-icon.width { background: var(--accent-green); }
    .facility-icon.elevator { background: var(--accent-orange); }
    .facility-icon.restroom { background: var(--accent-red); }
    
    .facility-title {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .facility-input {
      width: 100%;
      padding: var(--space-sm);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: var(--font-size-sm);
      background: var(--bg-primary);
      color: var(--text-primary);
    }
    
    .facility-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-sm);
    }
    
    .toggle-label {
      font-size: var(--font-size-sm);
      color: var(--text-primary);
    }
    
    .toggle-switch {
      width: 44px;
      height: 24px;
      background: var(--border-color);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background-color var(--duration-fast) var(--ease-out);
    }
    
    .toggle-switch.active {
      background: var(--accent-blue);
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform var(--duration-fast) var(--ease-out);
    }
    
    .toggle-switch.active::after {
      transform: translateX(20px);
    }
    
    .status-select {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-xs);
    }
    
    .status-option {
      padding: var(--space-xs);
      text-align: center;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      font-size: var(--font-size-xs);
      transition: all var(--duration-fast) var(--ease-out);
    }
    
    .status-option.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }
    
    .privacy-settings {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: var(--space-lg);
      margin: var(--space-lg) var(--space-md);
    }
    
    .privacy-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-md) 0;
    }
    
    .privacy-item:not(:last-child) {
      border-bottom: 1px solid var(--border-color);
    }
    
    .privacy-info {
      flex: 1;
    }
    
    .privacy-title {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .privacy-desc {
      font-size: var(--font-size-xs);
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    .publish-section {
      position: sticky;
      bottom: var(--tab-bar-height);
      background: var(--bg-primary);
      border-top: 1px solid var(--border-color);
      padding: var(--space-md);
    }
    
    .publish-button {
      width: 100%;
      padding: var(--space-lg);
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: var(--font-size-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
    }
    
    .publish-button:hover:not(:disabled) {
      background: #0056cc;
      transform: translateY(-1px);
    }
    
    .publish-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .progress-bar {
      height: 4px;
      background: var(--border-color);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: var(--space-md);
      display: none;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--accent-blue);
      width: 0%;
      transition: width var(--duration-normal) var(--ease-out);
    }
  </style>
</head>
<body>
  <div class="device-container">
    <!-- Status Bar -->
    <div class="status-bar">
      <span class="status-time">9:41</span>
      <div class="status-indicators">
        <i class="fas fa-signal" style="font-size: 12px;"></i>
        <i class="fas fa-wifi" style="font-size: 12px;"></i>
        <i class="fas fa-battery-three-quarters" style="font-size: 12px;"></i>
      </div>
    </div>
    
    <!-- Navigation -->
    <div class="nav-bar">
      <button class="nav-button" onclick="history.back()" aria-label="返回">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="nav-title">发布内容</div>
      <button class="nav-button" onclick="saveDraft()" aria-label="保存草稿">
        <i class="fas fa-save"></i>
      </button>
    </div>
    
    <!-- Content -->
    <div class="content create-container">
      <!-- Media Upload -->
      <div class="media-upload" onclick="selectMedia()">
        <input type="file" id="mediaInput" accept="image/*,video/*" style="display: none;" onchange="handleMediaSelect(event)">
        <div class="upload-placeholder" id="uploadPlaceholder">
          <div class="upload-icon">
            <i class="fas fa-camera"></i>
          </div>
          <div class="upload-text">添加图片或视频</div>
          <div class="upload-hint">点击选择媒体文件</div>
        </div>
        <div class="media-preview" id="mediaPreview" style="display: none;">
          <img id="previewImage" class="preview-image" style="display: none;" alt="预览图片">
          <video id="previewVideo" class="preview-video" style="display: none;" muted controls></video>
          <div class="media-actions">
            <button class="media-action" onclick="removeMedia(event)" aria-label="删除">
              <i class="fas fa-times"></i>
            </button>
            <button class="media-action" onclick="editMedia(event)" aria-label="编辑">
              <i class="fas fa-edit"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Basic Info -->
      <div class="form-section">
        <div class="section-title">
          <i class="fas fa-edit"></i>
          基本信息
        </div>
        
        <div class="form-group">
          <label for="postTitle" class="form-label">标题</label>
          <input 
            type="text" 
            id="postTitle" 
            class="form-input" 
            placeholder="描述您发现的无障碍设施..."
            maxlength="100"
            oninput="updateCharCount('postTitle', 'titleCount', 100)"
          >
          <div style="text-align: right; font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">
            <span id="titleCount">0</span>/100
          </div>
        </div>
        
        <div class="form-group">
          <label for="postDescription" class="form-label">详细描述</label>
          <textarea 
            id="postDescription" 
            class="form-input form-textarea" 
            placeholder="分享您的体验，包括设施的具体情况、使用感受等..."
            maxlength="500"
            oninput="updateCharCount('postDescription', 'descCount', 500)"
          ></textarea>
          <div style="text-align: right; font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">
            <span id="descCount">0</span>/500
          </div>
        </div>
        
        <div class="form-group">
          <label for="locationInput" class="form-label">位置信息</label>
          <div class="location-input-wrapper">
            <input 
              type="text" 
              id="locationInput" 
              class="form-input" 
              placeholder="搜索地点..."
              oninput="searchLocation(this.value)"
              onfocus="showLocationSuggestions()"
              onblur="hideLocationSuggestions()"
            >
            <div class="location-suggestions" id="locationSuggestions">
              <div class="suggestion-item" onclick="selectLocation('国贸地铁站 A 出口')">
                <i class="fas fa-subway suggestion-icon"></i>
                <div class="suggestion-text">
                  <div class="suggestion-name">国贸地铁站 A 出口</div>
                  <div class="suggestion-address">北京市朝阳区建外大街</div>
                </div>
              </div>
              <div class="suggestion-item" onclick="selectLocation('万达广场')">
                <i class="fas fa-shopping-bag suggestion-icon"></i>
                <div class="suggestion-text">
                  <div class="suggestion-name">万达广场</div>
                  <div class="suggestion-address">北京市朝阳区建外大街93号</div>
                </div>
              </div>
            </div>
          </div>
          <div class="current-location" onclick="useCurrentLocation()">
            <i class="fas fa-location-crosshairs" style="color: var(--accent-blue);"></i>
            <span>使用当前位置</span>
          </div>
        </div>
      </div>
      
      <!-- Quick Templates -->
      <div class="form-section">
        <div class="section-title">
          <i class="fas fa-magic"></i>
          快捷模板
        </div>
        
        <div class="templates-grid">
          <div class="template-item" onclick="selectTemplate('metro')">
            <div class="template-icon">
              <i class="fas fa-subway"></i>
            </div>
            <div class="template-name">地铁站通行</div>
          </div>
          
          <div class="template-item" onclick="selectTemplate('mall')">
            <div class="template-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="template-name">商场入口</div>
          </div>
          
          <div class="template-item" onclick="selectTemplate('hospital')">
            <div class="template-icon">
              <i class="fas fa-hospital"></i>
            </div>
            <div class="template-name">医院设施</div>
          </div>
          
          <div class="template-item" onclick="selectTemplate('park')">
            <div class="template-icon">
              <i class="fas fa-tree"></i>
            </div>
            <div class="template-name">公园步道</div>
          </div>
        </div>
      </div>
      
      <!-- Facility Details -->
      <div class="form-section">
        <div class="section-title">
          <i class="fas fa-cogs"></i>
          设施详情
        </div>
        
        <div class="facilities-grid">
          <div class="facility-control">
            <div class="facility-header">
              <div class="facility-icon slope">
                <i class="fas fa-angle-double-down"></i>
              </div>
              <div class="facility-title">坡度</div>
            </div>
            <input 
              type="number" 
              class="facility-input" 
              placeholder="坡度百分比"
              min="0" 
              max="50"
              id="slopeInput"
            >
            <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">
              建议 ≤ 8% (1:12)
            </div>
          </div>
          
          <div class="facility-control">
            <div class="facility-header">
              <div class="facility-icon width">
                <i class="fas fa-arrows-alt-h"></i>
              </div>
              <div class="facility-title">门宽</div>
            </div>
            <input 
              type="number" 
              class="facility-input" 
              placeholder="门宽厘米"
              min="60" 
              max="300"
              id="widthInput"
            >
            <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">
              建议 ≥ 85cm
            </div>
          </div>
          
          <div class="facility-control">
            <div class="facility-header">
              <div class="facility-icon elevator">
                <i class="fas fa-elevator"></i>
              </div>
              <div class="facility-title">电梯</div>
            </div>
            <div class="facility-toggle">
              <span class="toggle-label">电梯可用</span>
              <div class="toggle-switch" onclick="toggleFacility(this)"></div>
            </div>
            <div class="status-select">
              <div class="status-option active" onclick="selectStatus(this, 'elevator')">正常</div>
              <div class="status-option" onclick="selectStatus(this, 'elevator')">维修</div>
              <div class="status-option" onclick="selectStatus(this, 'elevator')">停运</div>
            </div>
          </div>
          
          <div class="facility-control">
            <div class="facility-header">
              <div class="facility-icon restroom">
                <i class="fas fa-restroom"></i>
              </div>
              <div class="facility-title">卫生间</div>
            </div>
            <div class="facility-toggle">
              <span class="toggle-label">无障碍卫生间</span>
              <div class="toggle-switch" onclick="toggleFacility(this)"></div>
            </div>
            <div class="status-select">
              <div class="status-option active" onclick="selectStatus(this, 'restroom')">可用</div>
              <div class="status-option" onclick="selectStatus(this, 'restroom')">清洁中</div>
              <div class="status-option" onclick="selectStatus(this, 'restroom')">维修</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Privacy Settings -->
      <div class="privacy-settings">
        <div class="section-title">
          <i class="fas fa-shield-alt"></i>
          隐私设置
        </div>
        
        <div class="privacy-item">
          <div class="privacy-info">
            <div class="privacy-title">匿名发布</div>
            <div class="privacy-desc">隐藏您的用户名和头像</div>
          </div>
          <div class="toggle-switch" onclick="togglePrivacy(this)"></div>
        </div>
        
        <div class="privacy-item">
          <div class="privacy-info">
            <div class="privacy-title">允许评论</div>
            <div class="privacy-desc">其他用户可以评论这条内容</div>
          </div>
          <div class="toggle-switch active" onclick="togglePrivacy(this)"></div>
        </div>
        
        <div class="privacy-item">
          <div class="privacy-info">
            <div class="privacy-title">显示位置</div>
            <div class="privacy-desc">在内容中显示具体位置信息</div>
          </div>
          <div class="toggle-switch active" onclick="togglePrivacy(this)"></div>
        </div>
      </div>
      
      <!-- Publish Section -->
      <div class="publish-section">
        <div class="progress-bar" id="uploadProgress">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <button class="publish-button" id="publishButton" onclick="publishPost()" disabled>
          <i class="fas fa-paper-plane"></i>
          <span>发布内容</span>
        </button>
      </div>
    </div>
  </div>
  
  <script src="../scripts/app.js"></script>
  <script>
    let selectedMedia = null;
    let selectedTemplate = null;
    
    // Media handling
    function selectMedia() {
      document.getElementById('mediaInput').click();
    }
    
    function handleMediaSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      selectedMedia = file;
      const preview = document.getElementById('mediaPreview');
      const placeholder = document.getElementById('uploadPlaceholder');
      const container = document.querySelector('.media-upload');
      
      container.classList.add('has-media');
      placeholder.style.display = 'none';
      preview.style.display = 'block';
      
      const url = URL.createObjectURL(file);
      
      if (file.type.startsWith('image/')) {
        const img = document.getElementById('previewImage');
        img.src = url;
        img.style.display = 'block';
        document.getElementById('previewVideo').style.display = 'none';
      } else if (file.type.startsWith('video/')) {
        const video = document.getElementById('previewVideo');
        video.src = url;
        video.style.display = 'block';
        document.getElementById('previewImage').style.display = 'none';
      }
      
      updatePublishButton();
    }
    
    function removeMedia(event) {
      event.stopPropagation();
      
      selectedMedia = null;
      const preview = document.getElementById('mediaPreview');
      const placeholder = document.getElementById('uploadPlaceholder');
      const container = document.querySelector('.media-upload');
      
      container.classList.remove('has-media');
      preview.style.display = 'none';
      placeholder.style.display = 'flex';
      
      // Clear file input
      document.getElementById('mediaInput').value = '';
      
      updatePublishButton();
    }
    
    function editMedia(event) {
      event.stopPropagation();
      alert('编辑媒体：裁剪、滤镜、添加标签等功能');
    }
    
    // Character count
    function updateCharCount(inputId, countId, maxLength) {
      const input = document.getElementById(inputId);
      const counter = document.getElementById(countId);
      
      counter.textContent = input.value.length;
      
      if (input.value.length > maxLength * 0.9) {
        counter.style.color = 'var(--accent-red)';
      } else {
        counter.style.color = 'var(--text-secondary)';
      }
      
      updatePublishButton();
    }
    
    // Location handling
    function searchLocation(query) {
      if (query.length >= 2) {
        showLocationSuggestions();
      } else {
        hideLocationSuggestions();
      }
    }
    
    function showLocationSuggestions() {
      document.getElementById('locationSuggestions').classList.add('show');
    }
    
    function hideLocationSuggestions() {
      setTimeout(() => {
        document.getElementById('locationSuggestions').classList.remove('show');
      }, 200);
    }
    
    function selectLocation(location) {
      document.getElementById('locationInput').value = location;
      hideLocationSuggestions();
      updatePublishButton();
    }
    
    function useCurrentLocation() {
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            document.getElementById('locationInput').value = `当前位置 (${position.coords.latitude.toFixed(4)}, ${position.coords.longitude.toFixed(4)})`;
            updatePublishButton();
          },
          (error) => {
            alert('获取位置失败，请手动输入地点');
          }
        );
      } else {
        alert('您的浏览器不支持定位功能');
      }
    }
    
    // Template selection
    function selectTemplate(type) {
      // Clear previous selection
      document.querySelectorAll('.template-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Select current
      event.currentTarget.classList.add('active');
      selectedTemplate = type;
      
      // Auto-fill based on template
      const templates = {
        metro: {
          title: '地铁站无障碍设施体验',
          description: '分享地铁站的无障碍通行体验，包括电梯、坡道、盲道等设施情况...',
          facilities: {
            elevator: true,
            slope: '5',
            width: '90'
          }
        },
        mall: {
          title: '商场无障碍入口体验',
          description: '商场的无障碍入口设计体验，包括坡道、自动门、通道宽度等...',
          facilities: {
            slope: '8',
            width: '120'
          }
        },
        hospital: {
          title: '医院无障碍设施体验',
          description: '医院的无障碍设施使用体验，包括专用通道、卫生间、电梯等...',
          facilities: {
            elevator: true,
            restroom: true,
            width: '100'
          }
        },
        park: {
          title: '公园无障碍步道体验',
          description: '公园内无障碍步道的使用体验，包括路面平整度、坡度设计等...',
          facilities: {
            slope: '3'
          }
        }
      };
      
      const template = templates[type];
      if (template) {
        document.getElementById('postTitle').value = template.title;
        document.getElementById('postDescription').value = template.description;
        
        // Update character counts
        updateCharCount('postTitle', 'titleCount', 100);
        updateCharCount('postDescription', 'descCount', 500);
        
        // Set facility values
        if (template.facilities.slope) {
          document.getElementById('slopeInput').value = template.facilities.slope;
        }
        if (template.facilities.width) {
          document.getElementById('widthInput').value = template.facilities.width;
        }
        
        updatePublishButton();
      }
    }
    
    // Facility controls
    function toggleFacility(toggle) {
      toggle.classList.toggle('active');
    }
    
    function selectStatus(option, category) {
      // Clear siblings
      option.parentElement.querySelectorAll('.status-option').forEach(opt => {
        opt.classList.remove('active');
      });
      
      // Select current
      option.classList.add('active');
    }
    
    function togglePrivacy(toggle) {
      toggle.classList.toggle('active');
    }
    
    // Publish functionality
    function updatePublishButton() {
      const title = document.getElementById('postTitle').value.trim();
      const description = document.getElementById('postDescription').value.trim();
      const location = document.getElementById('locationInput').value.trim();
      
      const button = document.getElementById('publishButton');
      const isValid = selectedMedia && title.length >= 5 && description.length >= 10 && location.length >= 2;
      
      button.disabled = !isValid;
    }
    
    function publishPost() {
      if (!selectedMedia) {
        alert('请选择图片或视频');
        return;
      }
      
      const title = document.getElementById('postTitle').value.trim();
      const description = document.getElementById('postDescription').value.trim();
      const location = document.getElementById('locationInput').value.trim();
      
      if (!title || !description || !location) {
        alert('请填写完整信息');
        return;
      }
      
      // Show progress
      const button = document.getElementById('publishButton');
      const progress = document.getElementById('uploadProgress');
      const fill = document.getElementById('progressFill');
      
      button.disabled = true;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>发布中...</span>';
      progress.style.display = 'block';
      
      // Simulate upload progress
      let progressValue = 0;
      const interval = setInterval(() => {
        progressValue += Math.random() * 15;
        if (progressValue >= 100) {
          progressValue = 100;
          clearInterval(interval);
          
          setTimeout(() => {
            showSuccessMessage();
          }, 500);
        }
        
        fill.style.width = progressValue + '%';
      }, 200);
    }
    
    function showSuccessMessage() {
      const button = document.getElementById('publishButton');
      button.innerHTML = '<i class="fas fa-check"></i><span>发布成功</span>';
      button.style.background = 'var(--accent-green)';
      
      setTimeout(() => {
        history.back();
      }, 1500);
    }
    
    function saveDraft() {
      const title = document.getElementById('postTitle').value;
      const description = document.getElementById('postDescription').value;
      
      if (title || description) {
        localStorage.setItem('post-draft', JSON.stringify({
          title,
          description,
          timestamp: Date.now()
        }));
        
        alert('草稿已保存');
      }
    }
    
    // Load draft on page load
    document.addEventListener('DOMContentLoaded', () => {
      const draft = localStorage.getItem('post-draft');
      if (draft) {
        const data = JSON.parse(draft);
        const age = Date.now() - data.timestamp;
        
        // Only load drafts younger than 24 hours
        if (age < 24 * 60 * 60 * 1000) {
          if (confirm('发现未完成的草稿，是否继续编辑？')) {
            document.getElementById('postTitle').value = data.title || '';
            document.getElementById('postDescription').value = data.description || '';
            
            updateCharCount('postTitle', 'titleCount', 100);
            updateCharCount('postDescription', 'descCount', 500);
            updatePublishButton();
          }
        }
      }
    });
    
    // Auto-save draft every 30 seconds
    setInterval(() => {
      const title = document.getElementById('postTitle').value;
      const description = document.getElementById('postDescription').value;
      
      if (title.trim() || description.trim()) {
        localStorage.setItem('post-draft', JSON.stringify({
          title,
          description,
          timestamp: Date.now()
        }));
      }
    }, 30000);
  </script>
</body>
</html>